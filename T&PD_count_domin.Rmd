---
title: Count Regression Model Dominance Analysis
subtitle: Documentation
#author: Joseph Luchman
author: Anonymized for review
output: html_notebook
editor_options: 
  markdown: 
    wrap: 72
---

This notebook provides documentation for the generation of the data used in the manuscript **Relative Importance Analysis for Count Regression Models**.

This document extends on the main manuscript by focusing more closely on implementation details. These implementation details are are not essential for the reader to understand the manuscript but are essential for reproducibility of the results. The details in this notebook also add additional context the manuscript's analyses by, for example, extending the Poisson regression results reported to negative Binomial regression.

Details on the random seed as well as the details of the R environment are available at the end of this notebook.

```{r set-up, include = FALSE}
library(gt)
library(MASS)
library(tidyverse)
library(magrittr)
library(domir)
library(parameters)
library(performance)
library(datawizard)
library(MCMCpack)

set.seed(84490856)
```

# Data Generation

The manuscript describes four tailoring shop characteristic IVs that will be used in the analysis. These IVs are:

  a. equipment reliability or _ER_
  b. assistant staffing levels or _AS_
  c. tailor skill level or _SL_
  d. tailor work experience or _WE_
  
Each of these IVs are generated for the simulated tailoring shops described in the manuscript as the first step in the data generation methodology.

My approach in generating the data for this manuscript was to begin by developing higher-order population parameters that were intended to give a specific set of results from a linear regression. These higher-order population parameters were useful as a conceptual structure from which to generate the data. The data, as generated, were only to be based loosely on this higher-order conceptual structure and the population parameters actually used to generate the data were sampled, and thus varied, from it in a way that was not intended to be directly under my control. As such, the results would in a general sense follow from the higher order conceptual structure imposed on the data but not be completely determined by me. 

This method of developing a well-structured set of parameters from which the observed data's parameters are sampled is advantageous in my view for this manuscript. Specifically, this structure allows the data to be generated in such a way as to illustrate key concepts yet also maintaining an element of randomness and realism in its appearance and in the results they produce.

## Generate IV Data

The generation of the four IVs began with setting up a higher-order population-level covariance matrix describing the variances of and interrelationships between the four tailoring shop IVs. This higher-order variance-covariance matrix was used as a set of parameters from which an sampled variance-covariance was obtained. This sampled variance covariance matrix was used as the population parameters from which the observations from this study were derived.

### Higher-Order Variance-Covariance Structure

The variances of IVs affect their contribution to the $R^2$ and thus will also affect the dominance designations and statistics produced by each IV. As an important determinant of dominance designations and statistics, the IVs were set to different values. The variances chosen were four equally spaced values between standard deviation values of 1 and 2. The first IV, _ER_, had a $\sigma_{ER} = 1.00$ and $\sigma^2_{ER} = 1.00$. The second IV, _AS_, had $\sigma_{AS} = 1.33$ and $\sigma^2_{AS} = 1.78$.  _SL_ had $\sigma_{SL} = 1.67$ and $\sigma^2_{SL} = 2.78$.  Finally, _WE_ had $\sigma_{WE} = 2.00$ and $\sigma^2_{WE} = 4.00$.

Dominance designations and statistics depend on interrelationships between the IVs. I did not have any reason to expect that a specific correlation structure would be more advantageous than another in defining the higher-order structure. As such, I defined the correlation matrix to be "balanced" across IVs such that the total redundancy for any one IV was identical to the others. 

All six correlations between the four IVs were thus designed to take on one of three values .250, .125, and .063 with the following values specified between each of the IVs: $r_{ER,AS} = .250$, $r_{ER,SL} = .125$, $r_{ER,WE} = .063$, $r_{AS,SL} = .063$, $r_{AS,WE} = .125$, and $r_{SL,WE} = .250$.

The code block below sets and reports on the correlation matrix as well as the the variance-covariance matrix on which it is based.

```{r gen-iv-mat}
namelist <- 
  c("ER", "AS", "SL", "WE")

Covariance_Matrix <- 
  c(1, .5^(2:4)*sqrt(1*c((4/3)^2, (5/3)^2, 4))*sqrt(1),
    .5^2*sqrt(1)*sqrt(1*(4/3)^2), (4/3)^2, .5^(4:3)*sqrt(1*(4/3)^2)*sqrt(1*c((5/3)^2, 4)),
    .5^(3:4)*sqrt(1*(5/3)^2)*sqrt(1*c(1, (4/3)^2)), (5/3)^2, .5^2*sqrt(1*(5/3)^2)*sqrt(1*4),
    .5^(4:2)*sqrt(1*4)*sqrt(1*c(1, (4/3)^2, (5/3)^2)), 4) %>%
  matrix(nrow = 4, byrow = TRUE)

Covariance_Matrix %>% 
  as.data.frame() %>%
  set_names(namelist) %>%
  set_rownames(namelist) %>%
  gt(rownames_to_stub = TRUE) %>%
  tab_header("Table S1: Population Covariance Matrix") %>%
  fmt_number(columns = 2:5, decimals = 4)

Covariance_Matrix %>% cov2cor() %>% 
  as.data.frame() %>%
  set_names(namelist) %>%  
  set_rownames(namelist) %>%
  gt(rownames_to_stub = TRUE) %>%
  tab_header("Table S2: Population Correlation Matrix")
```

...

### Sampled Values

The manuscript notes that a goal for the generation of the data for analytic use in this exercise is to obtain data that are 'realistic.' The balanced correlations that are determined at the population-level fail to 'feel real.' 

In an effort to add more realism to the dataset, the population covariance matrix is filtered through an inverse Wishart distribution using a single draw and large value (i.e., 100) for the degree of freedom parameter.

Sampling from the inverse Wishart distribution will produce a set of correlation values that are based on the balanced approach but appear more 'as though' they were generated by a real data generating process. The large value for the degrees of freedom has the effect of reducing the variances of the sampled matrix but also stabilizes the correlations of the values sampled to be closer to the population values. The variances of all the variables, once generated in the data, are multiplied by 100 to re-adjust them back to near their original values.

This section uses the set population covariance matrix as the scale parameter and a value of 100 as a degree of freedom parameter to obtain a single draw from the inverse Wishart distribution.  

The important component obtained by this sampled matrix is the correlations it produces. The covariance matrix will be updated/rescaled once the data are generated.

```{r sample-iv-mat}
Covariance_Matrix_Use <- 
  riwish(100, Covariance_Matrix)

Covariance_Matrix_Use %>% 
  as.data.frame() %>%
  set_names(namelist) %>%
  set_rownames(namelist) %>%
  gt(rownames_to_stub = TRUE) %>%
  tab_header("Table S3: Sampled Covariance Matrix") %>%
  fmt_number(columns = 2:5, decimals = 4)

Covariance_Matrix_Use %>% cov2cor() %>% 
  as.data.frame() %>%
  set_names(namelist) %>%  
  set_rownames(namelist) %>%
  gt(rownames_to_stub = TRUE) %>%
  tab_header("Table S4: Sampled Correlation Matrix") %>%
  fmt_number(columns = 2:5, decimals = 4)
```

There are a few points of note about the sampled results from Tables S3 and S4.  

As was expected, the variances for the four IVs have shrunk substantially moving from the population to the sampled matrix. Again, the change in the variance will be corrected to a values more similar to the population values once the data are generated. Note that the relative differences between the variances maintained the population-level pattern with $\sigma^2_{WE} > \sigma^2_{SL} > \sigma^2_{AS} > \sigma^2_{ER}$.

The correlations obtained by the sampled matrix also appear plausible for behavioral science data.

### Generate Observations

This section discusses the generation of the simulated multivariate Normal data using the sampled covariance matrix. The means of the variables were set at zero.

The sample size of the generated data were also determined through a random process. Specifically, the value was a draw from a random uniform distribution falling between 5,000 and 10,000 rounded to the nearest integer. The range chosen was expected to result in a sufficiently large sample size for the data analysis demonstration yet also be 'realistic.'

```{r gen-iv-data}
total_n <- 
  runif(n = 1, min = 5000, max = 10000) %>% 
  round()

Data_Frame <- 
  mvrnorm(n = total_n, 
          mu = rep(0, times = 4), 
          Sigma = Covariance_Matrix_Use) %>% 
  as.data.frame() %>%
  multiply_by(10) %>%
  set_names(namelist)

Data_Frame %>%
  summarise(
    across(.fns = mean),
    ) %>% 
  pivot_longer(everything(), names_to = "IV Name", values_to = "Mean") %>%
  left_join(
  Data_Frame %>%
  summarise(
    across(.fns = sd),
    ) %>% pivot_longer(everything(), names_to = "IV Name", 
                       values_to = "Standard Deviation")
  ) %>%
  left_join(
    Data_Frame %>% 
      cor %>% 
      as_tibble(rownames = "IV Name")
  ) %>%
  gt(rowname_col = "IV Name") %>%
  tab_header("Table S5: Sampled Data Descriptive Statistics") %>%
  fmt_number(columns = 2:7, decimals = 4) %>%
  tab_spanner(columns = c(ER, AS, SL, WE), label = "Correlations") %>%
  tab_style(
    style = cell_borders(sides = "right"),
    locations = cells_body(columns = "Standard Deviation")
  ) %>%
  tab_source_note(str_c("Sample Size of Simulated Data is ", 
                        nrow(Data_Frame) %>% format(big.mark = ","), "."))
  

```

A total of 6,870 multivariate Normally distributed observations were simulated for this data analysis.

The variances of each of the IVs, as noted above, were re-adjusted to closer to the original, population-level range.

## Generate Underlying Normally Distributed Dependent Variable

The generation of the number of stock jackets produced (SJ; Poisson distributed) and number of made-to-measure jackets produced (MJ; negative Binomial distributed) by the tailors, both DVs for the primary analyses, began with generating a single Normally distributed variable from which both were derived.

The underlying Normally distributed variable was generated as a linear combination of the four IVs.

Four population-level coefficient values were chosen for this variable were: $\beta_{ER} =.200$,  $\beta_{AS} =.173$,  $\beta_{SL} =.155$, $\beta_{WE} =.100$. These four values were chosen as they each, when squared and multiplied by the population-level variance, would produce a value of .04---not considering IV intercorrelations.

The coefficient values used for the generated underlying jackets variable (J) were sampled in a single draw from a Normal distribution with the four population values used as means. Each mean had a shared standard deviation of .05 to add variation to the coefficient values.

The error variance for J was set to be $1 - \sigma^2_{J}$ thus forcing the variance of J to be 1. The mean of J is also set to be 0.
	
### Population Values

This section sets the population coefficient values.

```{r pop-coefs}
Coefficient_Vector <- 
  c(.2, sqrt(.04/(4/3)), sqrt(.04/(5/3)), .1)

Coefficient_Vector %>%
  data.frame(name = namelist, value = .) %>%
  pivot_wider(everything()) %>%
  gt() %>%
  tab_header("Table S6: Population Coefficient Values") %>%
  fmt_number(columns = 1:4, decimals = 4)
```

### Sampled Values

This section implements the sampling for the 

```{r sampled-coeff}
Coefficient_Vector_Use <- 
  rnorm(4, Coefficient_Vector, .05)

Coefficient_Vector_Use %>%
  data.frame(name = namelist, value = .) %>%
  pivot_wider(everything()) %>%
  gt() %>%
  tab_header("Table S7: Sampled Coefficient Values") %>%
  fmt_number(columns = 1:4, decimals = 4)
```

The sampled coefficients varied from the population values as expected and happened to also follow the same ordinal pattern of $\beta_{ER} > \beta_{AS} > \beta_{SL} > \beta_{WE}$ as the population values.

### Generate Observations

This section implements generating J: the underlying Normal DV.

A linear regression predicting J using the four IVs is also implemented.

```{r gen-y-normal}
Data_Frame %<>%
  mutate(
    J = 
      ER*Coefficient_Vector_Use[[1]] + AS*Coefficient_Vector_Use[[2]] + 
      SL*Coefficient_Vector_Use[[3]] + WE*Coefficient_Vector_Use[[4]], 
    J = J + rnorm(total_n, 0, sqrt(1 - var(J)))
  )

Data_Frame %>%
  summarise("Mean" = mean(J)) %>% 
  bind_cols(
    Data_Frame %>%
      summarise("Standard Deviation" = sd(J))
  ) %>%
  bind_cols(
    Data_Frame %>% 
      cor %>% 
      as_tibble(rownames = "IV Name") %>%
      filter(`IV Name` == "J") %>%
      select(-J, -`IV Name`)
  ) %>%
  gt() %>%
  tab_header("Table S8: Underlying Dependent Variable Descriptive Statistics") %>%
  fmt_number(columns = 1:6, decimals = 4) %>%
  tab_spanner(columns = c(ER, AS, SL, WE), label = "Correlations") %>%
  tab_style(
    style = cell_borders(sides = "right"),
    locations = cells_body(columns = "Standard Deviation")
  )

Data_Frame %>%
  select(J) %>%
  ggplot(aes(x = J)) +
  stat_bin() +
  ggtitle("Figure Sa: Distribution of the Underlying Dependent Variable") +
  theme_light()

lm(J ~ ., data = Data_Frame) %>% 
  parameters() %>%
  select(-df_error, -CI) %>%
  rename(Low = "CI_low", High = "CI_high") %>%
  gt(rowname_col = "Parameter") %>%
  fmt_number(columns = 2:7, decimals = 4) %>%
  tab_spanner(columns = c(Low, High), label = "Confidence Interval") %>%
  tab_header("Table S9: Underlying Dependent Variable Linear Regression")
```

A couple of points to note about the J variable. The standard deviation depicted in Table S8 for J is, as expected, nearly 1. The correlations between the four IVs with J are all similar to one another with values around .4 despite. This too is as expected as the observed correlations between an IV and a DV are a function of a complex set of path analytic parameters combining each IV's known coefficient value (i.e., as observed in Table S2) with its correlation with each other variable as well as each other variable's known coefficient.

The results in Table S9 confirm that the population values in Table S6 were carried through to the data.

Figure Sa also depicts the distribution of J as observed in the data.

## Generate Poisson Dependent Variable

This section describes the translation of the underlying Normal variable J into the Poisson distributed SJ variable.

SJ is derived from J by first translating the Normal values to cumulative probabilities and, subsequently, translating those cumulative probabilities to Poisson quantiles assuming a mean of 1. A mean of 1 was chosen to make the SJ result as close to J as possible as both have variances of 1.	

```{r gen-y-poisson}
Data_Frame %<>%
  mutate(
    SJ = J %>% pnorm(log.p = TRUE) %>% qpois(1, log.p = TRUE)
  )

Data_Frame %>%
  summarise("Mean" = mean(SJ)) %>% 
  bind_cols(
    Data_Frame %>%
      summarise("Standard Deviation" = sd(SJ))
  ) %>%
  bind_cols(
    Data_Frame %>% 
      cor %>% 
      as_tibble(rownames = "IV Name") %>%
      filter(`IV Name` == "SJ") %>%
      select(-SJ, -J, -`IV Name`)
  ) %>%
  gt() %>%
  tab_header("Table S10: Poisson Dependent Variable Descriptive Statistics") %>%
  fmt_number(columns = 1:6, decimals = 4) %>%
  tab_spanner(columns = c(ER, AS, SL, WE), label = "Correlations") %>%
  tab_style(
    style = cell_borders(sides = "right"),
    locations = cells_body(columns = "Standard Deviation")
  )

Data_Frame %>%
  select(SJ) %>%
  ggplot(aes(x = SJ)) +
  stat_bin() +
  ggtitle("Figure Sb: Distribution of the Poisson Dependent Variable") +
  theme_light()
```

The results from Table S10 confirm expectations about the Poisson distributed variable's mean and standard deviation. SJ produced similar correlations with the IVs as the J variable on which it was based. The reduced correlation magnitudes among the IVs with SJ was due to the effect of partly discretizing the J variable into the SJ variable.

Figure Sb also shows the distribution of SJ variable.

## Generate Negative Binomial Dependent Variable

This section describes the translation of the underlying Normal variable J into the negative Binomial distributed MJ variable.

The generation of the MJ variable followed the same procedure as that to create SJ as it is created from the Normal cumulative probabilities of J then translated to negative Binomial quantiles assuming a _size_ of .5 and _mu_ parameter of 1.

The _size_ and _mu_ parameters were chosen to obtain a mean (i.e., the _mu_/$\mu$ value) of 1 to mirror the Poisson distribution but a variance that substantially exceeded 1; in this case  or a value of 3 as $\sigma^{2} = \mu + \frac{\mu^2}{size}$.

```{r gen-y-neg-bin}
Data_Frame %<>%
  mutate(
    MJ = J %>% pnorm(log.p = TRUE) %>% qnbinom(size = .5, mu = 1, log.p = TRUE)
  )

Data_Frame %>%
  summarise("Mean" = mean(MJ)) %>% 
  bind_cols(
    Data_Frame %>%
      summarise("Standard Deviation" = sd(MJ))
  ) %>%
  bind_cols(
    Data_Frame %>% 
      cor %>% 
      as_tibble(rownames = "IV Name") %>%
      filter(`IV Name` == "MJ") %>%
      select(-SJ, -J, -`IV Name`, -MJ)
  ) %>%
  gt() %>%
  tab_header("Table S11: Negative Binomial Dependent Variable Descriptive Statistics") %>%
  fmt_number(columns = 1:6, decimals = 4) %>%
  tab_spanner(columns = c(ER, AS, SL, WE), label = "Correlations") %>%
  tab_style(
    style = cell_borders(sides = "right"),
    locations = cells_body(columns = "Standard Deviation")
  )

Data_Frame %>%
  select(MJ) %>%
  ggplot(aes(x = MJ)) +
  stat_bin() +
  ggtitle("Figure Sc: Distribution of the Negative Binomial Dependent Variable") +
  theme_light()
```

The results from Table S11 confirm expectations about the negative Binomial distributed variable's mean and standard deviation ($\sigma_{MJ} = 1.757; \sigma^2_{MJ} = 3.087$; . MJ also produced similar correlations with the IVs as the J variable on which it was based but smaller values than SJ. The further reduced correlation magnitudes among the IVs with MJ was due to the effect of partly discretizing the J variable into the MJ variable paired with the strong skew introduced by the additional variance of the negative binomial

Figure Sc also shows the distribution of MJ variable.

## Report Primary Generated Data Descriptives

This section produces Table 1 in the manuscript including the descriptive statistics for all four IVs and both DVs.

```{r display-observed-descriptives}
Data_Frame %>%
  summarise(across(everything(), mean)) %>%
  pivot_longer(everything(), names_to = "Variable", values_to = "Mean") %>%
  left_join(
    Data_Frame %>%
      summarise(across(everything(), sd)) %>%
      pivot_longer(everything(), names_to = "Variable", 
                   values_to = "Standard Deviation"),
    by = "Variable"
  ) %>%
  left_join(
    Data_Frame %>% 
      cor %>% 
      as_tibble(rownames = "Variable"),
    by = "Variable"
  ) %>%
  filter(Variable != "J") %>%
  select(-J) %>%
  gt() %>%
  tab_header("Table 1: Descriptive Statistics") %>%
  fmt_number(columns = 2:9, decimals = 4) %>%
  tab_spanner(columns = c(ER, AS, SL, WE, SJ, MJ), label = "Correlations") %>%
  tab_style(
    style = cell_borders(sides = "right"),
    locations = cells_body(columns = "Standard Deviation")
  ) %T>%
  print %>%
  gtsave(filename = "descrips_initial.tex", path = "./includes/")
```

## Poisson with Offset Dependent Variables

The manuscript also describes two other variables: SJ_RH and SJ_VH.

These two variables are variants of SJ where different holidays are celebrated resulting in different numbers of days in which the tailors work.

### Uncorrelated Offset Dependent Variable

This section describes the process of generating the Poisson distributed, uncorrleated offset dependent variable SJ_RH.

This count variable is generated as multiple trials if a binomial distribution. Repeated trials from a binomial distribution are known to be Poisson distributed with a rate/mean parameter that can be derived as $np = \lambda$ where In this case the _n_ is the number of trials and _p_ is the probability of the event occurring. Thus, to generate a Poisson distribution to approximate SJ, I could set the binomial distibution to have an _n_ of 10 and a _p_ of .1 to obtain the mean of 1 (i.e., $10*.1 = 1$).

Adjusting the SJ-based binomial distribution to incorporate different 'exposure' time is then a matter of adjusting the _n_ parameter for each tailor. For this version of the variable, a random, uniformly distributed integer from 1 to 10 is sampled randomly for all tailors to represent the _n_ value.

Note that RH, the factor by which the Poisson variable is 'offset,' is retained for modeling.

```{r offset-uncorrelated}
Data_Frame %<>%
  mutate(
    RH = sample(1:10, total_n, replace = TRUE),
    SJ_RH = 
      J %>% pnorm(log.p = TRUE) %>%
      qbinom(RH, .1, log.p = TRUE)
  )

Data_Frame %>%
  summarise("Mean" = mean(SJ_RH)) %>% 
  bind_cols(
    Data_Frame %>%
      summarise("Standard Deviation" = sd(SJ_RH))
  ) %>%
  bind_cols(
    Data_Frame %>% 
      cor %>% 
      as_tibble(rownames = "IV Name") %>%
      filter(`IV Name` == "SJ_RH") %>%
      select(-SJ, -J, -`IV Name`, -MJ, -SJ_RH, -RH)
  ) %>%
  gt() %>%
  tab_header("Table S12: Uncorrelated Offset Poisson Dependent Variable Descriptive Statistics") %>%
  fmt_number(columns = 1:6, decimals = 4) %>%
  tab_spanner(columns = c(ER, AS, SL, WE), label = "Correlations") %>%
  tab_style(
    style = cell_borders(sides = "right"),
    locations = cells_body(columns = "Standard Deviation")
  )

Data_Frame %>%
  select(RH) %>%
  mutate(RH = as_factor(RH)) %>%
  ggplot(aes(x = RH)) +
  stat_count() +
  ggtitle("Figure Sd: Distribution of the Uncorrelated Offset Variable") +
  theme_light()

Data_Frame %>%
  select(SJ_RH) %>%
  ggplot(aes(x = SJ_RH)) +
  stat_bin() +
  ggtitle("Figure Se: Distribution of the Uncorrelated Offset Poisson Dependent Variable") +
  theme_light()
```

The descriptive statistics for SJ_RH are similar to SJ but shrunken given that the conceptual rate parameter/mean is now `r mean(1:10)*.1`.

In addition, all the correlations between SJ_RH and the IVs are shrunken relative to SJ due to the reduced variance observed in SJ_RH.

### Correlated Offset Depedent Variable

This section describes the process for generating the correlated offset Poisson distributed dependent variable.

The correlated offset variable is implemented in a way similar to the uncorrelated offset variable except that the set of trials _n_ for each observation will be based on the four IVs instead of randomly sampled.

The process to create the correlated offsets began in a way similar to that of generating the underlying Normal dependent variable by sampling values for each IV as four draws from a Normal distribution with a standard deviation of .05 and the population coefficient vector used to create the underlying Normal dependent variable reflected over 0 (i.e., multipled by -1).

```{r correlated-offset-coef}
Coefficient_Vector_Offset <- 
  rnorm(4, Coefficient_Vector*-1, .05)

Coefficient_Vector_Offset %>%
  data.frame(name = namelist, value = .) %>%
  pivot_wider(everything()) %>%
  gt() %>%
  tab_header("Table S13: Sampled Offset Coefficient Values") %>%
  fmt_number(columns = 1:4, decimals = 4)
```

The offset coefficient values were used, like those from the underlying Normal dependent variable, to generate a unit, Normally distributed 'offset' variable. This 'offset' variable was then translated to a uniform distribution between 1 and 10 like the uncorrelated _n_. The translation also followed a similar procedure to how the underlying Normal dependent variable was translated into Poisson and negative Binomial variables---by translating the Normal variable to cumulative probabilities, and then subsequently, translating those probabilities into quantiles of the uniform distribution ranging from 0 to 10 taking the next highest/`ceiling` integer's value.

These IV-correlated _n_ values were then used in the same way as the uncorrelated _n_ values to reduce the number of trials observed of the Binomial distribution.

The correlated exposure variable is also retained for use in modeling.

```{r correlated-offset}
Data_Frame %<>%
  mutate(
    VH =
      ER*Coefficient_Vector_Offset[[1]] + AS*Coefficient_Vector_Offset[[2]] + 
      SL*Coefficient_Vector_Offset[[3]] + WE*Coefficient_Vector_Offset[[4]],
    VH = VH + rnorm(total_n, 0, sqrt(1 - var(VH))),
    VH = VH %>% pnorm(log.p = TRUE) %>% 
      qunif(0, 10, log.p = TRUE) %>% ceiling(),
    SJ_VH = J %>% pnorm(log.p = TRUE) %>% 
      qbinom(VH, .1, log.p = TRUE)
  )

Data_Frame %>%
  summarise("Mean" = mean(SJ_VH)) %>% 
  bind_cols(
    Data_Frame %>%
      summarise("Standard Deviation" = sd(SJ_VH))
  ) %>%
  bind_cols(
    Data_Frame %>% 
      cor %>% 
      as_tibble(rownames = "IV Name") %>%
      filter(`IV Name` == "SJ_VH") %>%
      select(-SJ, -J, -`IV Name`, -MJ, -SJ_RH, -RH, -SJ_VH, -VH)
  ) %>%
  gt() %>%
  tab_header("Table S14: Correlated Offset Poisson Dependent Variable Descriptive Statistics") %>%
  fmt_number(columns = 1:6, decimals = 4) %>%
  tab_spanner(columns = c(ER, AS, SL, WE), label = "Correlations") %>%
  tab_style(
    style = cell_borders(sides = "right"),
    locations = cells_body(columns = "Standard Deviation")
  )

Data_Frame %>%
  select(VH) %>%
  mutate(VH = as_factor(VH)) %>%
  ggplot(aes(x = VH)) +
  stat_count() +
  ggtitle("Figure Sf: Distribution of the Correlated Offset Variable") +
  theme_light()

Data_Frame %>%
  select(SJ_VH) %>%
  ggplot(aes(x = SJ_VH)) +
  stat_bin() +
  ggtitle("Figure Sg: Distribution of the Correlated Offset Poisson Dependent Variable") +
  theme_light()
```

The mean and standard deviation are similar to the uncorrelated exposure DV but the correlations the DV with the IVs have shrunk due to the inverse relationship each has with the exposure variable.

## Report Primary Generated Data Descriptives

This section produces Table 6 in the manuscript including the descriptive statistics for both new DVs and their correlations with the IVs.

```{r display-exposure-descriptives}
Data_Frame %>%
  summarise(across(c(SJ_RH, RH, SJ_VH, VH), mean)) %>%
  pivot_longer(everything(), names_to = "Variable", values_to = "Mean") %>%
  left_join(
    Data_Frame %>%
      summarise(across(c(SJ_RH, RH, SJ_VH, VH), sd)) %>%
      pivot_longer(everything(), names_to = "Variable", 
                   values_to = "Standard Deviation"),
    by = "Variable"
  ) %>%
  left_join(
    Data_Frame %>% 
      cor %>% 
      as_tibble(rownames = "Variable"),
    by = "Variable"
  ) %>%
  filter(Variable %in% c("SJ_RH", "RH", "SJ_VH", "VH")) %>%
  select(Variable, Mean, `Standard Deviation`, ER, AS, SL, WE) %>%
  gt() %>%
  tab_header("Table 6: Descriptive Statistics") %>%
  fmt_number(columns = 2:7, decimals = 4) %>%
  tab_spanner(columns = c(ER, AS, SL, WE), label = "Correlations") %>%
  tab_style(
    style = cell_borders(sides = "right"),
    locations = cells_body(columns = "Standard Deviation")
  ) %T>%
  print %>%
  gtsave(filename = "descrips_exposure.tex", path = "./includes/")
```

```{r save-data, results='hide', include=FALSE}
saveRDS(Data_Frame, "./Data_Results/DF.rds")
```

```{r load-data, results='hide', include=FALSE}
Data_Frame <- 
  readRDS("./Data_Results/DF.rds")
```

# Primary Modeling

This section describes the model estimation and dominance analysis of the primary analysis models involving SJ and MJ variables.

## Poisson Regressions

This section's focus is on obtaining all modeling results associated with the PR using SJ as DV.

### Obtain Modeling Results

This section estimates and reports on the PR results. An IRR and standardized computation are also included.

These results form Table 2 of the manuscript.

```{r SJ-pois-reg}
SJ_pois_reg <- 
  glm(SJ ~ ER + AS + SL + WE, 
      data = Data_Frame, 
      family = poisson()) 

SJ_pois_reg_unstd <- 
  SJ_pois_reg %>% 
  parameters() 

SJ_pois_reg_std <- 
  SJ_pois_reg %>%
  standardise_parameters(method = "basic")

SJ_pois_reg_unstd  %>% 
  select(-df_error, -CI) %>%
  rename(Low = "CI_low", High = "CI_high") %>%
  mutate(IRR = exp(Coefficient)) %>%
  left_join(
    SJ_pois_reg_std %>% 
      select(Parameter, Std_Coefficient) %>%
      rename(Standardized = "Std_Coefficient"),
    by = "Parameter") %>%
  gt(rowname_col = "Parameter") %>%
  fmt_number(columns = 2:9, decimals = 4) %>%
  tab_spanner(columns = c(Low, High), label = "Confidence Interval") %>%
  tab_header("Table 2: Poisson Regression") %>% 
  tab_style(
    style = cell_borders(sides = "right"),
    locations = cells_body(columns = "p")
  ) %T>%
  print %>%
  gtsave(filename = "poisson_coeff.tex", path = "./includes/")
```

The results in Table 2 echo those of Table S9 in that the obtained coefficients are derived directly from the results reported on in Table S7---with a translation to a Poisson, log-linear model scale. 

### Obtain All Subsets R-square

This section captures each Poisson model subset's $R^2$ value associated with a specific set of IVs.

```{r SJ-pois-reg-subsets}
IV_subsets <- 
  expand_grid(c("ER", ""), c("AS", ""), c("SL", ""), c("WE", "")) %>%
  set_names(c("ER", "AS", "SL", "WE")) %>%
  mutate(num_per = rowSums(across(.fns = ~ str_length(.) > 1))) %>%
  arrange(num_per, desc(ER), desc(AS), desc(SL), desc(WE)) %>%
  select(-num_per) %>%
  slice(-1) %>% 
  t() %>%
  as_tibble() 

SJ_pois_subsets <-
  map_dbl(IV_subsets,
          \(ivs) {
            discard(ivs, ~ str_length(.) < 2) %>%
            reformulate(response = "SJ") %>%
              glm(data = Data_Frame, family = poisson()) %>%
              r2_kullback(adjust = FALSE)
          }
  )

IV_subset_names <-
  map_chr(IV_subsets, 
          \(ivs) {
            discard(ivs, ~ str_length(.) < 2) %>%
            str_c(., collapse = " + ")
          }
  )

IV_subset_names %>% 
  as_tibble() %>%
  bind_cols(SJ_pois_subsets) %>%
  set_names(c("variable", "SJ")) %>%
  gt(rowname_col = "variable") %>%
  tab_header("Table S15: All Subsets Deviance R-square Poisson Models") %>%
  fmt_number(columns = 2, decimals = 4)
```

These results help to explain the observed complete dominance results and will be used in the manuscript to demonstrate specific computations.

### Dominance Analytic Results

This section captures the dominance analytic results for the Poisson modeling.

```{r SJ-pois-DA}
SJ_pois_DA <-
  domir(SJ ~ ER + AS + SL + WE, 
        \(fml, ...) {
          res <- 
            glm(fml, ...) 
          return(r2_kullback(res, adjust = FALSE))
        },
        data = Data_Frame, family = poisson())

SJ_pois_DA %>% 
  pluck("General_Dominance") %>%
  as_tibble(rownames = "Variable") %>%
  left_join(SJ_pois_DA %>% 
              pluck("Standardized") %>%
              as_tibble(rownames = "Variable"),
            by = "Variable") %>%
  set_names(c("Variable", "General Dominance", "Standardized")) %>%
  gt(rowname_col = "Variable") %>%
  tab_header("Table S16: Poisson Model General Dominance Statistics") %>%
  fmt_number(columns = 2:3, decimals = 4) %>%
  tab_source_note(str_c("Overall Deviance R-square is ", 
                        SJ_pois_reg %>% r2_kullback() %>% 
                          sprintf("%5.4f", .), "."))

SJ_pois_DA %>% 
  pluck("Conditional_Dominance") %>%
  as_tibble(rownames = "Variable") %>%
  set_names(c("Variable", str_c("Subset Size: ", 1:4))) %>%
  gt(rowname_col = "Variable") %>%
  tab_header("Table S17: Poisson Model Conditional Dominance Statistics") %>%
  fmt_number(columns = 2:5, decimals = 4)

SJ_pois_DA %>% 
  pluck("Complete_Dominance") %>%
  as_tibble(rownames = "Dominating Variable") %>%
  mutate(
    `Dominating Variable` = str_remove(`Dominating Variable`, "Dmnates_")
  ) %>%
  set_names(c("Dominating Variable", str_c("Dominated Variable: ", 
                                           c("ER", "AS", "SL", "WE")))) %>%
  gt(rowname_col = "Dominating Variable") %>%
  tab_header("Table S18: Poisson Model Complete Dominance Statistics") %>%
  sub_missing() %>% 
  tab_stubhead("Dominating Variable")
```

The PR-based general dominance statistics in Table S.. show that the dominance hierarchy among IVs do not show large differences as all four IVs have relatively similar general dominance statistics. This result is not unexpected given the design of the population-level effects.

The sampled results' dominance hierarchy show that AS is most important (i.e., generally dominates all others), followed by ER, then SL, and finally WE (i.e., generally dominated by all others).

The standardized values express the general dominance statistics as a proportion of the $R^2$.

The conditional dominance statistics based on the PR model reported in Table S.. add to the general dominance statistics in that AS is shown also to conditionally dominate ER and WE but _not_ SL as the size 4 results for AS and SL reverse. ER, the second most dominant, also only conditionally dominates WE given the size 4 results.  Finally, SL does not conditionally dominate WE either given the pattern change between sizes 2 and 3.

Finally, the complete dominance results in Table S.. show that the only complete dominance designation possible among the IVs is between AS and ER.

## Negative Binomial Regressions

This section's focus is on obtaining all modeling results associated with the NBR using MJ as DV.

### Obtain Modeling Results

This section estimates and reports on the NBR results. As with the PR, an IRR and standardized computation are also included. Additionally, the Theta parameter is included in a footnote.

These results form Table 3 of the manuscript.

```{r MJ-nb-reg}
MJ_nb_reg <- 
  glm.nb(MJ ~ ER + AS + SL + WE, 
      data = Data_Frame) 

MJ_nb_reg_unstd <- 
  MJ_nb_reg %>% 
  parameters() 

MJ_nb_reg_std <- 
  MJ_nb_reg %>%
  standardise_parameters(method = "basic")

MJ_nb_reg_unstd  %>% 
  select(-df_error, -CI) %>%
  rename(Low = "CI_low", High = "CI_high") %>%
  mutate(IRR = exp(Coefficient)) %>%
  left_join(
    MJ_nb_reg_std %>% 
      select(Parameter, Std_Coefficient) %>%
      rename(Standardized = "Std_Coefficient"),
    by = "Parameter") %>%
  gt(rowname_col = "Parameter") %>%
  fmt_number(columns = 2:9, decimals = 4) %>%
  tab_spanner(columns = c(Low, High), label = "Confidence Interval") %>%
  tab_header("Table 3: Negative Binomial Regression") %>% 
  tab_style(
    style = cell_borders(sides = "right"),
    locations = cells_body(columns = "p") 
  ) %>%
  tab_source_note(str_c("Theta parameter is ", 
                        MJ_nb_reg$theta %>% 
                          format(big.mark = ",", digits = 4), ".")) %T>%
  print %>%
  gtsave(filename = "nb_coeff.tex", path = "./includes/")
```

The results in Table 3 again echo those of Table S9 in that the obtained coefficients are derived directly from the results reported on in Table S7. The results are also relatively similar to Table 2 with the exception of larger values across all coefficients and a slightly different rank order of the standardized results.

### Obtain All Subsets R-square

This section captures each negative Binomial model subset's $R^2$ value associated with a specific set of IVs.

```{r MJ-nb-reg-subsets}
MJ_nb_subsets <-
  map_dbl(IV_subsets, 
          \(ivs) {
            discard(ivs, ~ str_length(.) < 2) %>%
            reformulate(response = "MJ") %>%
              glm.nb(data = Data_Frame) %>%
              r2_kullback(adjust = FALSE)
          }
  )

IV_subset_names %>% 
  as_tibble() %>%
  bind_cols(MJ_nb_subsets) %>%
  set_names(c("variable", "MJ")) %>%
  gt(rowname_col = "variable") %>%
  tab_header("Table S19: All Subsets Deviance R-square Negative Binomial Models") %>%
  fmt_number(columns = 2, decimals = 4)
```

As with the individual PR results, the NBR results are used for computations and explaining the pattern of complete dominance results.

### Dominance Analytic Results

This section captures the dominance analytic results for the negative Binomial modeling.

```{r MJ-nb-DA}
MJ_nb_DA <-
  domir(MJ ~ ER + AS + SL + WE, 
        \(fml, ...) {
          res <- 
            glm.nb(fml, ...) 
          return(r2_kullback(res, adjust = FALSE))
        },
        data = Data_Frame)

MJ_nb_DA %>% 
  pluck("General_Dominance") %>%
  as_tibble(rownames = "Variable") %>%
  left_join(MJ_nb_DA %>% 
              pluck("Standardized") %>%
              as_tibble(rownames = "Variable"),
            by = "Variable") %>%
  set_names(c("Variable", "General Dominance", "Standardized")) %>%
  gt(rowname_col = "Variable") %>%
  tab_header("Table S20: Negative Binomial Model General Dominance Statistics") %>%
  fmt_number(columns = 2:3, decimals = 4) %>%
  tab_source_note(str_c("Overall Deviance R-square is ", 
                        MJ_nb_reg %>% r2_kullback(adjust = FALSE) %>% 
                          sprintf("%5.4f", .), "."))

MJ_nb_DA %>% 
  pluck("Conditional_Dominance") %>%
  as_tibble(rownames = "Variable") %>%
  set_names(c("Variable", str_c("Subset Size: ", 1:4))) %>%
  gt(rowname_col = "Variable") %>%
  tab_header("Table S21: Negative Binomial Model Conditional Dominance Statistics") %>%
  fmt_number(columns = 2:5, decimals = 4)

MJ_nb_DA %>% 
  pluck("Complete_Dominance") %>%
  as_tibble(rownames = "Dominating Variable") %>%
  mutate(
    `Dominating Variable` = str_remove(`Dominating Variable`, "Dmnates_")
  ) %>%
  set_names(c("Dominating Variable", str_c("Dominated Variable: ", 
                                           c("ER", "AS", "SL", "WE")))) %>%
  gt(rowname_col = "Dominating Variable") %>%
  tab_header("Table S22: Negative Binomial Model Complete Dominance Statistics") %>%
  sub_missing() %>% 
  tab_stubhead("Dominating Variable")
```

The NBR-based DA results are quite similar to those obtained for the PR-based results. One notable exception is the importance ordering between importance SL and WE. 

In the NBR, WE generally dominates SL. No other dominance designations were possible between these IVs.

<!-- # ~~~ NB regs don't work with dominance_analysis() - method dispatch issue? -->
<!-- # ~~~ they have r2() method but DA doesn't recognize it -->
<!-- # nb_result %>% -->
<!-- #   dominance_analysis() -->

## Combined All Subsets Reporting

This section captures all PR and NBR subsets

Table 4 in the manuscript is produced in this section.

```{r comb-subsets-display}
IV_subset_names %>% 
  as_tibble() %>%
  bind_cols(SJ_pois_subsets) %>%
  bind_cols(MJ_nb_subsets) %>%
  set_names(c("variable", "Poisson/SJ", "Negative Binomial/MJ")) %>%
  gt(rowname_col = "variable") %>%
  tab_header("Table 4: All Subsets Deviance R-square Results Across Models") %>%
  fmt_number(columns = 2:3, decimals = 4) %T>%
  print() %>%
  gtsave(filename = "all_subsets.tex", path = "./includes/")
```

## Combined General Dominance Reporting

This section captures the general dominance analysis reporting.

Table 5 in the manuscript is generated in this section.

```{r gend-dom-display}
SJ_pois_DA %>% 
  pluck("General_Dominance") %>%
  as_tibble(rownames = "Variable") %>%
  left_join(MJ_nb_DA %>% 
              pluck("General_Dominance") %>%
              as_tibble(rownames = "Variable"),
            by = "Variable") %>%
  set_names(c("Variable", "Poisson/SJ", "Negative Binomial/MJ")) %>%
  bind_rows(tibble(Variable = "Overall", 
                   `Poisson/SJ` = SJ_pois_reg %>% r2_kullback(adjust = FALSE), 
                   `Negative Binomial/MJ` = MJ_nb_reg %>% r2_kullback(adjust = FALSE))) %>%
  gt(rowname_col = "Variable") %>%
  tab_header("Table 5: General Dominance Statistics") %>%
  tab_style(
    style = cell_borders(sides = "bottom"),
    locations = cells_body(rows = 4)
  ) %>%
  fmt_number(columns = 2:3, decimals = 4) %T>%
  print %>%
  gtsave(filename = "gen_dom.tex", path = "./includes/")
```

## Conditional Dominance Graphic Reporting

This section captures the conditional dominance analysis reporting.

Figure 1 in the manuscript is generated in this section.

```{r condit-domin-display, fig.height = 3, fig.width = 4.5}
SJ_pois_DA %>%
  pluck("Conditional_Dominance") %>%
  as_tibble(rownames = "IV") %>%
  pivot_longer(
    cols = starts_with("subset_size"),
    names_to = "Subset Size",
    values_to = "Conditional Dominance Statistic",
    names_prefix = "subset_size_"
    ) %>% 
  mutate(
    IV = fct_relevel(IV, "ER", "AS", "SL", "WE"),
    `Subset Size` = `Subset Size` %>% as.integer
  ) %>%
  ggplot(
    aes(x = `Subset Size`, y = `Conditional Dominance Statistic`, group = IV, color = IV)
  ) + geom_line() + 
  theme_linedraw() +
  labs(linetype = "") + 
  coord_trans(xlim = c(.9, 4.1), ylim = c(.023, .195), expand = FALSE, y = "log") + 
  theme(legend.position = c(.90, .89), legend.box.background = element_rect(color = "black"), 
        legend.title = element_blank(), legend.text = element_text(size = 7), 
        legend.key.height = unit(7, "pt"), axis.text.y = element_text(size = 7), 
        legend.margin = margin(b = .5, l = .5, r = .5)) + 
  scale_y_continuous(n.breaks = 5) + scale_color_viridis_d()

ggsave("condit_gph.png", height = 4*.75, width = 6*.75, 
       units = "in", path = "./includes/")
```

# Exposure Modeling

## Uncorrelated Exposure without Offset

### Obtain Modeling Results

```{r SJ_RH-reg-no-exp}
SJ_RH_reg_no_exp <- 
  glm(SJ_RH ~ ER + AS + SL + WE, 
      data = Data_Frame, 
      family = poisson())

SJ_RH_reg_no_exp_unstd <- 
  SJ_RH_reg_no_exp %>% 
  parameters() 

SJ_RH_reg_no_exp_unstd %>%
  select(-df_error, -CI) %>%
  rename(Low = "CI_low", High = "CI_high") %>%
  gt(rowname_col = "Parameter") %>%
  fmt_number(columns = 2:7, decimals = 4) %>%
  tab_spanner(columns = c(Low, High), label = "Confidence Interval") %>%
  tab_header("Table S24: Uncorrelated Exposure without Offset")
```

### Dominance Analysis Results

```{r SJ_RH-DA-no-exp}
SJ_RH_no_exp_DA <-
  domir(SJ_RH ~ ER + AS + SL + WE, 
        \(fml, ...) {
          res <- 
            glm(fml, ...) 
          return(r2_kullback(res, adjust = FALSE))
        },
        data = Data_Frame, family = poisson())

SJ_RH_no_exp_DA %>% 
  pluck("General_Dominance") %>%
  as_tibble(rownames = "Variable") %>%
  left_join(SJ_RH_no_exp_DA %>% 
              pluck("Standardized") %>%
              as_tibble(rownames = "Variable"),
            by = "Variable") %>%
  set_names(c("Variable", "General Dominance", "Standardized")) %>%
  gt(rowname_col = "Variable") %>%
  tab_header("Table S25: Uncorrelated Exposure with No Offset General Dominance Statistics") %>%
  fmt_number(columns = 2:3, decimals = 4) %>%
  tab_source_note(str_c("Overall Deviance R-square is ", 
                        SJ_RH_reg_no_exp %>% r2_kullback(adjust = FALSE) %>% 
                          sprintf("%5.4f", .), "."))

SJ_RH_no_exp_DA %>% 
  pluck("Conditional_Dominance") %>%
  as_tibble(rownames = "Variable") %>%
  set_names(c("Variable", str_c("Subset Size: ", 1:4))) %>%
  gt(rowname_col = "Variable") %>%
  tab_header("Table S26: Uncorrelated Exposure with No Offset Conditional Dominance Statistics") %>%
  fmt_number(columns = 2:5, decimals = 4)

SJ_RH_no_exp_DA %>% 
  pluck("Complete_Dominance") %>%
  as_tibble(rownames = "Dominating Variable") %>%
  mutate(
    `Dominating Variable` = str_remove(`Dominating Variable`, "Dmnates_")
  ) %>%
  set_names(c("Dominating Variable", str_c("Dominated Variable: ", 
                                           c("ER", "AS", "SL", "WE")))) %>%
  gt(rowname_col = "Dominating Variable") %>%
  tab_header("Table S27: Uncorrelated Exposure with No Offset Complete Dominance Statistics") %>%
  sub_missing() %>% 
  tab_stubhead("Dominating Variable")
```

## Uncorrelated Exposure with Offset

### Obtain Modeling Results

```{r SJ_RH-reg-exp}
SJ_RH_reg_exp <- 
  glm(SJ_RH ~ ER + AS + SL + WE + offset(log(RH)), 
      data = Data_Frame, 
      family = poisson())

SJ_RH_reg_exp_unstd <- 
  SJ_RH_reg_exp %>% 
  parameters() 

SJ_RH_reg_exp_unstd %>%
  select(-df_error, -CI) %>%
  rename(Low = "CI_low", High = "CI_high") %>%
  gt(rowname_col = "Parameter") %>%
  fmt_number(columns = 2:7, decimals = 4) %>%
  tab_spanner(columns = c(Low, High), label = "Confidence Interval") %>%
  tab_header("Table S27: Uncorrelated Exposure with Offset")
```

### Dominance Analysis Results

```{r SJ_RH-DA-exp}
SJ_RH_exp_DA <-
  domir(SJ_RH ~ ER + AS + SL + WE, 
        \(fml, ...) {
          res <- 
            fml %>%
            update(. ~ . + offset(log(RH))) %>%
            glm(...) 
          return(r2_kullback(res, adjust = FALSE))
        },
        data = Data_Frame, family = poisson())

SJ_RH_exp_DA %>% 
  pluck("General_Dominance") %>%
  as_tibble(rownames = "Variable") %>%
  left_join(SJ_RH_exp_DA %>% 
              pluck("Standardized") %>%
              as_tibble(rownames = "Variable"),
            by = "Variable") %>%
  set_names(c("Variable", "General Dominance", "Standardized")) %>%
  gt(rowname_col = "Variable") %>%
  tab_header("Table S28: Uncorrelated Exposure with Offset General Dominance Statistics") %>%
  fmt_number(columns = 2:3, decimals = 4) %>%
  tab_source_note(str_c("Overall Deviance R-square is ", 
                        SJ_RH_reg_exp %>% r2_kullback(adjust = FALSE) %>% 
                          sprintf("%5.4f", .), "."))

SJ_RH_exp_DA %>% 
  pluck("Conditional_Dominance") %>%
  as_tibble(rownames = "Variable") %>%
  set_names(c("Variable", str_c("Subset Size: ", 1:4))) %>%
  gt(rowname_col = "Variable") %>%
  tab_header("Table S29: Uncorrelated Exposure with Offset Conditional Dominance Statistics") %>%
  fmt_number(columns = 2:5, decimals = 4)

SJ_RH_exp_DA %>% 
  pluck("Complete_Dominance") %>%
  as_tibble(rownames = "Dominating Variable") %>%
  mutate(
    `Dominating Variable` = str_remove(`Dominating Variable`, "Dmnates_")
  ) %>%
  set_names(c("Dominating Variable", str_c("Dominated Variable: ", 
                                           c("ER", "AS", "SL", "WE")))) %>%
  gt(rowname_col = "Dominating Variable") %>%
  tab_header("Table S30: Uncorrelated Exposure with Offset Complete Dominance Statistics") %>%
  sub_missing() %>% 
  tab_stubhead("Dominating Variable")
```

## Combined Uncorrelated Exposure Model Reporting

```{r SJ_RH-reg-table}
SJ_RH_reg_no_exp_unstd %>% 
  select(Parameter, Coefficient) %>%
  mutate(IRR = exp(Coefficient)) %>%
  left_join(
    SJ_RH_reg_exp_unstd %>% 
      select(Parameter, Coefficient) %>%
      rename(Coefficient_e = "Coefficient") %>%
      mutate(IRR_e = exp(Coefficient_e)),
    by = "Parameter") %>%
  gt(rowname_col = "Parameter") %>%
  fmt_number(columns = 2:5, decimals = 4) %>%
  tab_header("Table 7: Uncorrelated Exposure Poisson Regression") %>% 
  cols_label(Coefficient_e = "Coefficient", IRR_e = "IRR") %>%
  tab_spanner(columns = c("Coefficient", "IRR"), label = "No Offset") %>%
  tab_spanner(columns = c("Coefficient_e", "IRR_e"), label = "Offset") %T>%
  print %>%
  gtsave(filename = "uncorr_exp_coeff.tex", path = "./includes/")
```

## Combined Uncorrelated Exposure Dominance Statistic Reporting

```{r SJ_RH-DA-table}
SJ_RH_no_exp_DA %>% 
  pluck("General_Dominance") %>%
  as_tibble(rownames = "Parameter") %>%
  bind_rows(
    tibble("Parameter" = "Overall", 
           value = SJ_RH_no_exp_DA %>%
             pluck("General_Dominance") %>%
             sum)
  ) %>%
  left_join(
    SJ_RH_exp_DA %>% 
      pluck("General_Dominance") %>%
      as_tibble(rownames = "Parameter") %>%
      bind_rows(
        tibble("Parameter" = "Overall", 
               value = SJ_RH_exp_DA %>%
                 pluck("General_Dominance") %>%
                 sum)
      ) %>% 
      rename(value_e = "value"),
    by = "Parameter") %>%
  gt(rowname_col = "Parameter") %>%
  fmt_number(columns = 2:3, decimals = 4) %>%
  tab_header("Table 8: Uncorrelated Exposure Poisson-based General Dominance Statistics") %>% 
  cols_label(value = "No Offset", value_e = "Offset") %T>%
  print %>%
  gtsave(filename = "uncorr_exp_da.tex", path = "./includes/")
```

## Correlated Exposure without Offset

### Obtain Modeling Results

```{r SJ_VH-reg-no-exp}
SJ_VH_reg_no_exp <- 
  glm(SJ_VH ~ ER + AS + SL + WE, 
      data = Data_Frame, 
      family = poisson())

SJ_VH_reg_no_exp_unstd <- 
  SJ_VH_reg_no_exp %>% 
  parameters() 

SJ_VH_reg_no_exp_unstd %>%
  select(-df_error, -CI) %>%
  rename(Low = "CI_low", High = "CI_high") %>%
  gt(rowname_col = "Parameter") %>%
  fmt_number(columns = 2:7, decimals = 4) %>%
  tab_spanner(columns = c(Low, High), label = "Confidence Interval") %>%
  tab_header("Table S31: Correlated Exposure without Offset")
```

### Dominance Analysis Results

```{r SJ_VH-DA-no-exp}
SJ_VH_no_exp_DA <-
  domir(SJ_VH ~ ER + AS + SL + WE, 
        \(fml, ...) {
          res <- 
            glm(fml, ...) 
          return(r2_kullback(res, adjust = FALSE))
        },
        data = Data_Frame, family = poisson())

SJ_VH_no_exp_DA %>% 
  pluck("General_Dominance") %>%
  as_tibble(rownames = "Variable") %>%
  left_join(SJ_VH_no_exp_DA %>% 
              pluck("Standardized") %>%
              as_tibble(rownames = "Variable"),
            by = "Variable") %>%
  set_names(c("Variable", "General Dominance", "Standardized")) %>%
  gt(rowname_col = "Variable") %>%
  tab_header("Table S32: Correlated Exposure with No Offset General Dominance Statistics") %>%
  fmt_number(columns = 2:3, decimals = 4) %>%
  tab_source_note(str_c("Overall Deviance R-square is ", 
                        SJ_VH_reg_no_exp %>% r2_kullback(adjust = FALSE) %>% 
                          sprintf("%5.4f", .), "."))

SJ_VH_no_exp_DA %>% 
  pluck("Conditional_Dominance") %>%
  as_tibble(rownames = "Variable") %>%
  set_names(c("Variable", str_c("Subset Size: ", 1:4))) %>%
  gt(rowname_col = "Variable") %>%
  tab_header("Table S33: Correlated Exposure with No Offset Conditional Dominance Statistics") %>%
  fmt_number(columns = 2:5, decimals = 4)

SJ_VH_no_exp_DA %>% 
  pluck("Complete_Dominance") %>%
  as_tibble(rownames = "Dominating Variable") %>%
  mutate(
    `Dominating Variable` = str_remove(`Dominating Variable`, "Dmnates_")
  ) %>%
  set_names(c("Dominating Variable", str_c("Dominated Variable: ", 
                                           c("ER", "AS", "SL", "WE")))) %>%
  gt(rowname_col = "Dominating Variable") %>%
  tab_header("Table S34: Correlated Exposure with No Offset Complete Dominance Statistics") %>%
  sub_missing() %>% 
  tab_stubhead("Dominating Variable")
```

## Correlated Exposure with Offset

### Obtain Modeling Results

```{r SJ_VH-reg-exp}
SJ_VH_reg_exp <- 
  glm(SJ_VH ~ ER + AS + SL + WE + offset(log(VH)), 
      data = Data_Frame, 
      family = poisson())

SJ_VH_reg_exp_unstd <- 
  SJ_VH_reg_exp %>% 
  parameters() 

SJ_VH_reg_exp_unstd %>%
  select(-df_error, -CI) %>%
  rename(Low = "CI_low", High = "CI_high") %>%
  gt(rowname_col = "Parameter") %>%
  fmt_number(columns = 2:7, decimals = 4) %>%
  tab_spanner(columns = c(Low, High), label = "Confidence Interval") %>%
  tab_header("Table S35: Correlated Exposure with Offset")
```

### Dominance Analysis Results

```{r SJ_VH-DA-exp}
SJ_VH_exp_DA <-
  domir(SJ_VH ~ ER + AS + SL + WE, 
        \(fml, ...) {
          res <- 
            fml %>%
            update(. ~ . + offset(log(VH))) %>%
            glm(...) 
          return(r2_kullback(res, adjust = FALSE))
        },
        data = Data_Frame, family = poisson())

SJ_VH_exp_DA %>% 
  pluck("General_Dominance") %>%
  as_tibble(rownames = "Variable") %>%
  left_join(SJ_VH_exp_DA %>% 
              pluck("Standardized") %>%
              as_tibble(rownames = "Variable"),
            by = "Variable") %>%
  set_names(c("Variable", "General Dominance", "Standardized")) %>%
  gt(rowname_col = "Variable") %>%
  tab_header("Table S36: Correlated Exposure with Offset General Dominance Statistics") %>%
  fmt_number(columns = 2:3, decimals = 4) %>%
  tab_source_note(str_c("Overall Deviance R-square is ", 
                        SJ_VH_reg_exp %>% r2_kullback(adjust = FALSE) %>% 
                          sprintf("%5.4f", .), "."))

SJ_VH_exp_DA %>% 
  pluck("Conditional_Dominance") %>%
  as_tibble(rownames = "Variable") %>%
  set_names(c("Variable", str_c("Subset Size: ", 1:4))) %>%
  gt(rowname_col = "Variable") %>%
  tab_header("Table S37: Correlated Exposure with Offset Conditional Dominance Statistics") %>%
  fmt_number(columns = 2:5, decimals = 4)

SJ_VH_exp_DA %>% 
  pluck("Complete_Dominance") %>%
  as_tibble(rownames = "Dominating Variable") %>%
  mutate(
    `Dominating Variable` = str_remove(`Dominating Variable`, "Dmnates_")
  ) %>%
  set_names(c("Dominating Variable", str_c("Dominated Variable: ", 
                                           c("ER", "AS", "SL", "WE")))) %>%
  gt(rowname_col = "Dominating Variable") %>%
  tab_header("Table S38: Correlated Exposure with Offset Complete Dominance Statistics") %>%
  sub_missing() %>% 
  tab_stubhead("Dominating Variable")
```

## Combined Correlated Exposure Model Reporting

```{r SJ_VH-reg-table}
SJ_VH_reg_no_exp_unstd %>% 
  select(Parameter, Coefficient) %>%
  mutate(IRR = exp(Coefficient)) %>%
  left_join(
    SJ_VH_reg_exp_unstd %>% 
      select(Parameter, Coefficient) %>%
      rename(Coefficient_e = "Coefficient") %>%
      mutate(IRR_e = exp(Coefficient_e)),
    by = "Parameter") %>%
  gt(rowname_col = "Parameter") %>%
  fmt_number(columns = 2:5, decimals = 4) %>%
  tab_header("Table 9: Correlated Exposure Poisson Regression") %>% 
  cols_label(Coefficient_e = "Coefficient", IRR_e = "IRR") %>%
  tab_spanner(columns = c("Coefficient", "IRR"), label = "No Offset") %>%
  tab_spanner(columns = c("Coefficient_e", "IRR_e"), label = "Offset") %T>%
  print %>%
  gtsave(filename = "corr_exp_coeff.tex", path = "./includes/")
```

## Combined Correlated Exposure Dominance Statistic Reporting

```{r SJ_VH-DA-table}
SJ_VH_no_exp_DA %>% 
  pluck("General_Dominance") %>%
  as_tibble(rownames = "Parameter") %>%
  bind_rows(
    tibble("Parameter" = "Overall", 
           value = SJ_VH_no_exp_DA %>%
             pluck("General_Dominance") %>%
             sum)
  ) %>%
  left_join(
    SJ_VH_exp_DA %>% 
      pluck("General_Dominance") %>%
      as_tibble(rownames = "Parameter") %>%
      bind_rows(
        tibble("Parameter" = "Overall", 
               value = SJ_VH_exp_DA %>%
                 pluck("General_Dominance") %>%
                 sum)
      ) %>% 
      rename(value_e = "value"),
    by = "Parameter") %>%
  gt(rowname_col = "Parameter") %>%
  fmt_number(columns = 2:3, decimals = 4) %>%
  tab_header("Table 10: Correlated Exposure Poisson-based General Dominance Statistics") %>% 
  cols_label(value = "No Offset", value_e = "Offset") %T>%
  print %>%
  gtsave(filename = "corr_exp_da.tex", path = "./includes/")
```

# Records and Reproducibility

```{r records-repro}
sessionInfo()
```

The random seed information used in this session:

    84490856
    Min: 1, Max: 99999999
    2022-08-14 14:50:02 UTC
    Random.org
